{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5" style="align-items: center;">
  <h1 class="mb-4 text-center">Gestion des ventes</h1>
  <p>Bienvenue dans le module de gestion des ventes. Ici, vous pouvez suivre vos transactions, gérer les clients et analyser les performances de vente.</p>

  <div class="container mt-4">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card text-white bg-primary mb-4 shadow-lg border-0 rounded-3 h-100">
          <div class="card-header bg-transparent d-flex justify-content-center">
            <h5 class="card-title fw-bold"><i class="fas fa-chart-line me-2"></i>Chiffre d'affaire</h5>
          </div>
          <div class="card-body text-center py-4">
            <h2 class="display-8 fw-bold mb-1">{{ chiffre_affaire }} €</h2>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card text-white bg-warning mb-4 shadow-lg border-0 rounded-3 h-100">
          <div class="card-header bg-transparent d-flex justify-content-center">
            <h5 class="card-title fw-bold"><i class="fas fa-euro-sign me-2"></i>Ventes</h5>
          </div>
          <div class="card-body text-center py-4">
            <h2 class="display-8 fw-bold mb-1">{{ total_ventes }} FCFA</h2>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card text-white bg-danger mb-4 shadow-lg border-0 rounded-3 h-100">
          <div class="card-header bg-transparent d-flex justify-content-center">
            <h5 class="card-title fw-bold"><i class="fas fa-calendar-day me-2"></i>Ventes du jour</h5>
          </div>
          <div class="card-body text-center py-4">
            <h2 class="display-8 fw-bold mb-1">{{ ventes_du_jour }}</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container mt-5"> 
  <h2>Liste des produits</h2>
  <div class="content flex-grow-1 p-4">
    <h2>Point de vente</h2>
    <div class="row">
      <!-- Colonne des produits -->
      <div class="col-lg-8 col-md-7">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Catalogue Produits</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th class="text-center">ID</th>
                    <th>Nom de l'article</th>
                    <th class="text-end">Prix unitaire</th>
                    <th class="text-center">Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for article in articles %}
                  <tr>
                    <td class="text-center">{{ article.id }}</td>
                    <td>{{ article.nom }}</td>
                    <td class="text-end">{{ article.prix_unitaire }} FCFA</td>
                    <td class="text-center">
                      <a href="{% url 'ajouter_au_panier' article.id %}" class="btn btn-outline-success btn-sm">
                        Ajouter {{ article.nom }}
                      </a>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="4" class="text-center">Aucun article disponible.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer text-muted">
            Total articles : {{ articles|length }}
          </div>
        </div>
      </div>

      <!-- Colonne panier -->
      <div class="col-lg-4 col-md-5">
        <div class="card mb-4">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">Panier</h5>
          </div>
          <ul class="list-group list-group-flush">
            {% if panier.items %}
              {% for item in panier.items %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ item.article.nom }} x{{ item.quantite }}
                <span>{{ item.prix_total }} FCFA</span>
                <div>
                  <a href="{% url 'modifier_quantite_panier' item.article.id %}?action=moins" class="btn btn-sm btn-outline-secondary me-1">-</a>
                  <a href="{% url 'modifier_quantite_panier' item.article.id %}?action=plus" class="btn btn-sm btn-outline-secondary">+</a>
                  <a href="{% url 'supprimer_du_panier' item.article.id %}" class="btn btn-sm btn-outline-danger ms-2">×</a>
                </div>
              </li>
              {% endfor %}
              <li class="list-group-item d-flex justify-content-between align-items-center bg-light fw-bold">
                Total
                <span>{{ panier.total }} FCFA</span>
              </li>
            {% else %}
              <li class="list-group-item text-center">Le panier est vide.</li>
            {% endif %}
          </ul>
          <div class="card-footer">
            {% if panier.items %}
              <a href="{% url 'valider_vente' %}" class="btn btn-primary w-100">Valider la vente</a>
            {% else %}
              <button class="btn btn-primary w-100" disabled>Valider la vente</button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid p-4">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white d-flex justify-content-between">
          <h5 class="mb-0">Historique des ventes</h5>
        </div>
        <div class="card-body p-4">
          <div class="table-responsive">
            <table class="table table-hover table-bordered align-middle mb-0">
              <thead class="table-dark">
                <tr>
                  <th class="text-center" style="width: 10%">#ID</th>
                  <th class="text-center" style="width: 25%">Montant</th>
                  <th class="text-center" style="width: 25%">Date</th>
                  <th class="text-center" style="width: 20%">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for vente in historique_ventes %}
                <tr>
                  <th class="text-center">{{ vente.id }}</th>
                  <td class="text-end fw-bold">{{ vente.montant }} FCFA</td>
                  <td class="text-center">
                    <span class="badge bg-light text-dark">{{ vente.date|date:"d/m/Y" }}</span>
                  </td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm">
                      <a href="{% url 'details_vente' vente.id %}" class="btn btn-outline-info" title="Détails"><i class="fas fa-eye"></i></a>
                      <a href="{% url 'facture_vente' vente.id %}" class="btn btn-outline-primary" title="Facture"><i class="fas fa-file-invoice"></i></a>
                      <a href="{% url 'supprimer_vente' vente.id %}" class="btn btn-outline-danger" title="Supprimer" onclick="return confirm('Confirmer la suppression ?')"><i class="fas fa-trash-alt"></i></a>
                    </div>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">Aucune vente enregistrée.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
